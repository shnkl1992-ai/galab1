<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>قلاب 1 — اختبار الدائرة والتحكّم</title>
<style>
  :root{--bg:#0b1020;--fg:#e6ecff;--green:#22c55e;--orange:#f59e0b}
  *{box-sizing:border-box}
  body{margin:0;background:#0b1020;color:var(--fg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  header{display:flex;gap:8px;flex-wrap:wrap;align-items:center;padding:10px;border-bottom:1px solid #223}
  h1{font-size:16px;margin:0 6px 0 0}
  button{padding:8px 12px;border:1px solid #335;background:#182044;color:var(--fg);border-radius:10px}
  .wrap{max-width:1100px;margin:12px auto;padding:0 10px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
  .arena{position:relative;height:560px;border:1px solid #223;border-radius:16px;background:radial-gradient(circle at 50% 40%,#111a3a 0%,#0b1020 70%)}
  .table{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:320px;height:320px;border-radius:999px;background:#0e1e3a;border:2px solid #2a355e;display:flex;align-items:center;justify-content:center;color:#9fb2ff}
  .seat{position:absolute;width:150px;text-align:center}
  .name{font-size:13px;margin-bottom:6px}
  .name.green{color:var(--green)} .name.orange{color:var(--orange)}
  .hand{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;min-height:58px}
  .card{width:40px;height:58px;border-radius:8px;background:linear-gradient(180deg,#1f2547,#11162c);border:1px solid #3a4577;display:flex;align-items:center;justify-content:center;font-weight:700}
  .back{background:linear-gradient(135deg,#103060,#3b82f6)}
  .sel{outline:2px solid #60a5fa;outline-offset:2px}
  .side{border:1px solid #223;border-radius:16px;padding:10px}
  .log{height:220px;overflow:auto;border-top:1px dashed #2a355e;margin-top:8px;padding-top:6px;font-size:13px;line-height:1.5}
  .pill{display:inline-block;background:#1a274a;border-radius:999px;padding:4px 8px;font-size:12px;margin-inline-start:6px}
</style>
</head>
<body>
<header>
  <h1>قلاب 1 — اختبار</h1>
  <button id="deal">توزيع</button>
  <button id="show" disabled>إظهار يدي</button>
  <button id="buy" disabled>أكل</button>
  <button id="discard" disabled>قط/تمرير</button>
  <button id="next" disabled>التالي</button>
</header>

<div class="wrap">
  <div class="grid">
    <div class="arena" id="arena">
      <div class="table"><div>الأرض: <span id="groundCount">0</span> ورقة</div></div>
    </div>
    <div class="side">
      <div>الدور: <b id="turnLabel">—</b> <span class="pill">الأرض <b id="groundList"></b></span></div>
      <div class="log" id="log"></div>
    </div>
  </div>
</div>

<script>
(() => {
  const PLAYERS = 6;
  const TEAM = i => i % 2 === 0 ? "green" : "orange";
  const NAMES = ["A","B","C","D","E","F"];
  const RANKS = ["1","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const logEl = id("log");
  const arena = id("arena");

  let players = [];
  let ground = [];
  let turn = 0;
  let shown = false;
  let selected = null;

  // Helpers
  function id(x){ return document.getElementById(x); }
  function log(msg){ const d=document.createElement("div"); d.textContent=msg; logEl.prepend(d); }
  function seatPos(i){
    const rect = arena.getBoundingClientRect();
    const r = Math.min(rect.width, rect.height)/2 - 90;
    const cx = rect.width/2, cy = rect.height/2;
    const ang = (Math.PI*2)*(i/PLAYERS) - Math.PI/2; // يدور دائرة
    return { left: cx + r*Math.cos(ang) - 75, top: cy + r*Math.sin(ang) - 70 };
  }
  function cardEl(txt, faceUp, onClick){
    const d = document.createElement("div");
    d.className = "card " + (faceUp ? "" : "back");
    d.textContent = faceUp ? txt : "";
    if(onClick) d.onclick = onClick;
    return d;
  }
  function render(){
    // الأرض
    id("groundCount").textContent = ground.length;
    id("groundList").textContent = ground.map(c=>c).join(" ");
    // امسح المقاعد وارسمها
    [...arena.querySelectorAll(".seat")].forEach(n=>n.remove());
    for(let i=0;i<PLAYERS;i++){
      const seat = document.createElement("div");
      seat.className = "seat";
      const p = seatPos(i);
      seat.style.left = p.left+"px"; seat.style.top = p.top+"px";

      const nm = document.createElement("div");
      nm.className = "name "+TEAM(i);
      nm.textContent = `لاعب ${NAMES[i]}${i===turn?" • دوره":""}`;

      const hand = document.createElement("div");
      hand.className = "hand";
      const face = (i===turn && shown);
      players[i].hand.forEach((c,idx)=>{
        const elc = cardEl(c, face, ()=>{
          if(i!==turn || !shown) return;
          selected = idx; render();
        });
        if(i===turn && selected===idx) elc.classList.add("sel");
        hand.appendChild(elc);
      });

      seat.appendChild(nm);
      seat.appendChild(hand);
      arena.appendChild(seat);
    }
    id("turnLabel").textContent = `لاعب ${NAMES[turn]}`;
    id("show").disabled = false;
    id("buy").disabled  = !(shown && players[turn].hand.length>0);
    id("discard").disabled = !(shown && players[turn].hand.length>0);
    id("next").disabled = !shown;
  }

  // افتراض: دك بسيط عشان الاختبار (ما نبي نعقّد)
  function simpleDeck(){
    const d=[];
    for(const r of RANKS){ for(let i=0;i<2;i++) d.push(r); } // نسختين من كل رقم
    for(let i=d.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [d[i],d[j]]=[d[j],d[i]]; }
    return d;
  }

  // أزرار
  id("deal").onclick = () => {
    try{
      const deck = simpleDeck();
      players = Array.from({length:PLAYERS}, (_,i)=>({hand: deck.splice(0,5)}));
      // لاعب أول ياخذ السادسة
      players[0].hand.push(deck.shift());
      ground = ["1","2","3","4","5","6","7"]; // أرض مبدئية باينة
      turn = 0; shown = false; selected = null;
      log("تم التوزيع. اضغط «إظهار يدي» ثم اختر كرت.");
      render();
    }catch(e){ log("خطأ: "+e.message); alert(e.message); }
  };

  id("show").onclick = () => { shown = !shown; if(!shown) selected=null; render(); };

  id("buy").onclick = () => {
    try{
      if(!shown) return alert("اظهر يدك أول");
      const idx = (selected ?? 0);
      const card = players[turn].hand[idx];
      const gIdx = ground.findIndex(g => g===card);
      if(gIdx>-1){
        ground.splice(gIdx,1); // اخذ من الأرض
        log(`لاعب ${NAMES[turn]} أكل ${card} من الأرض`);
      }else{
        log(`ما لقى ${card} على الأرض — (اختبار: ما ندوّر على أكل اللاعبين هنا)`);
      }
      players[turn].hand.splice(idx,1);
      selected = null;
      render();
    }catch(e){ log("خطأ: "+e.message); }
  };

  id("discard").onclick = () => {
    try{
      if(!shown) return alert("اظهر يدك أول");
      const idx = (selected ?? 0);
      const card = players[turn].hand.splice(idx,1)[0];
      ground.push(card);
      log(`لاعب ${NAMES[turn]} قط ${card}`);
      selected = null;
      render();
    }catch(e){ log("خطأ: "+e.message); }
  };

  id("next").onclick = () => {
    shown = false; selected = null;
    turn = (turn+1)%PLAYERS;
    log(`الدور → لاعب ${NAMES[turn]}`);
    render();
  };

  // رسم أولي فاضي
  players = Array.from({length:PLAYERS}, ()=>({hand:[]}));
  render();
})();
</script>
</body>
</html>
