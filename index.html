<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù‚Ù„Ø§Ø¨ 1 â€” Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø© (6 Ù„Ø§Ø¹Ø¨ÙŠÙ†)</title>
<style>
  :root{--bg:#0b1020;--fg:#e6ecff;--muted:#9fb2ff;--green:#22c55e;--orange:#f59e0b;--dealer:#ef4444}
  *{box-sizing:border-box}
  body{margin:0;background:radial-gradient(1100px 700px at 70% -10%,#1a2250 0%,#0b1020 60%),#0b1020;color:var(--fg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans",Arial}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 14px;border-bottom:1px solid rgba(255,255,255,.08);background:linear-gradient(180deg,rgba(255,255,255,.06),transparent)}
  h1{margin:0;font-size:18px}
  .controls{display:flex;gap:8px;flex-wrap:wrap}
  button,select{appearance:none;border:1px solid rgba(255,255,255,.15);background:#1b2242;color:var(--fg);padding:9px 12px;border-radius:10px;font-size:15px}
  button.primary{background:linear-gradient(180deg,#6366f1,#4338ca);border:none;box-shadow:0 8px 18px rgba(67,56,202,.35)}
  .wrap{max-width:1100px;margin:12px auto;padding:0 10px 28px}
  .layout{display:grid;grid-template-columns:1fr 360px;gap:12px}
  .arena{position:relative;min-height:560px;border-radius:18px;border:1px solid rgba(255,255,255,.08);background:radial-gradient(circle at 50% 50%,#0f1737 0%,#0b1020 65%);box-shadow:0 10px 36px rgba(0,0,0,.35)}
  .table{position:absolute;inset:50% auto auto 50%;transform:translate(-50%,-50%);width:360px;height:360px;border-radius:999px;background:#0f203b;border:2px solid rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;flex-wrap:wrap;padding:10px;gap:6px;z-index:1}
  .seat{position:absolute;width:150px;text-align:center;z-index:2}
  .name{font-size:13px;opacity:.95;margin-bottom:6px}
  .name.green{color:var(--green)} .name.orange{color:var(--orange)}
  .dealerTag{display:inline-block;margin-top:4px;background:var(--dealer);padding:2px 6px;border-radius:999px;font-size:11px}
  .pile{display:flex;gap:6px;flex-wrap:wrap;justify-content:center}
  .hand{display:flex;gap:5px;flex-wrap:wrap;justify-content:center;min-height:62px}
  .eat{display:flex;gap:4px;flex-wrap:wrap;justify-content:center;margin-top:6px;min-height:40px}
  .card{width:40px;height:58px;border-radius:8px;background:linear-gradient(180deg,#1f2547,#11162c);border:1px solid rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;font-weight:700}
  .back{background:linear-gradient(135deg,#102040,#3b82f6);border:1px solid rgba(255,255,255,.2)}
  .sel{outline:2px solid #60a5fa;outline-offset:2px}
  .panel{border:1px solid rgba(255,255,255,.08);border-radius:14px;padding:10px;background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.02))}
  .side{height:560px;overflow:auto}
  .row{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin:6px 0}
  .badge{font-size:12px;background:rgba(255,255,255,.08);padding:3px 8px;border-radius:999px}
  .log{font-size:13px;line-height:1.6;max-height:200px;overflow:auto;border-top:1px dashed rgba(255,255,255,.12);margin-top:8px;padding-top:6px}
  .scoreBox{display:flex;gap:8px;flex-wrap:wrap}
  .team{background:rgba(255,255,255,.06);padding:6px 8px;border-radius:10px}
  .pill{display:inline-flex;gap:6px;align-items:center;background:rgba(255,255,255,.08);padding:4px 8px;border-radius:999px;font-size:12px}
  .timer{display:inline-block;min-width:28px;text-align:center;background:#1f2937;border-radius:999px;padding:2px 8px;font-weight:700}
</style>
</head>
<body>
<header>
  <h1>Ù‚Ù„Ø§Ø¨ 1 â€” Ù†Ø³Ø®Ø© Ù…Ø¨Ø³Ø·Ø© (6 Ù„Ø§Ø¹Ø¨ÙŠÙ†)</h1>
  <div class="controls">
    <button id="btnDeal" class="primary">Ø¨Ø¯Ø§ÙŠØ©/ØªÙˆØ²ÙŠØ¹</button>
    <button id="btnShow" disabled>Ø¥Ø¸Ù‡Ø§Ø± ÙŠØ¯ÙŠ</button>
    <button id="btnBuy" disabled>Ø£ÙƒÙ„</button>
    <button id="btnPass" disabled>ØªÙ…Ø±ÙŠØ± (Ù…Ø¹ Ù‚Ø·Ù‘)</button>
    <button id="btnNext" disabled>ØªÙ…Ø±ÙŠØ± Ø§Ù„Ø¯ÙˆØ±</button>
    <select id="rankSelect" disabled></select>
    <button id="btnScore">Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‚Ø§Ø·</button>
  </div>
</header>

<div class="wrap">
  <div class="layout">
    <div class="arena panel" id="arena">
      <div class="table panel">
        <div class="row">
          <span class="badge">Ø§Ù„Ø£Ø±Ø¶ (1..K)</span>
          <span class="pill">Ø§Ù„Ø³Ø­Ø¨Ø© Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <b id="stockLeft">â€”</b></span>
          <span class="pill">Ø§Ù„Ù…Ø±Ø­Ù„Ø©: <b id="phaseLabel">â€”</b></span>
          <span class="pill">Ø§Ù„ÙˆÙ‚Øª: <b class="timer" id="timer">â€”</b></span>
        </div>
        <div id="ground" class="pile"></div>
      </div>
    </div>

    <div class="panel side">
      <div class="row scoreBox">
        <div class="team">ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø®Ø¶Ø±: <b id="scoreGreen">0</b></div>
        <div class="team">ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ: <b id="scoreOrange">0</b></div>
        <div class="team">Ø§Ù„Ø¯ÙˆØ±: <b id="turnLabel">â€”</b></div>
      </div>
      <div class="row"><span class="badge">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø§Ù„Ù„Ø¹Ø¨</span></div>
      <div class="log" id="log"></div>
      <div id="winner" class="row" style="display:none"><span class="badge">Ø§Ù„Ù†ØªÙŠØ¬Ø© Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©:</span> <b id="winnerText"></b></div>
    </div>
  </div>
</div>

<script>
(()=>{
  const PLAYERS=6, TEAM=i=>i%2===0?'green':'orange', NAMES=['A','B','C','D','E','F'];
  const RANKS=['1','2','3','4','5','6','7','8','9','10','J','Q','K'];
  const COPIES_PER_RANK=48, JOKERS_COUNT=35;
  const SCORING=new Set(['10','J','Q','K','1']);

  let deck=[], stock=[], players=[], ground=[], dealer=0, turn=0;
  let shown=false, selected=null, phase='normal';
  let endgameUnlocked=false;   // ÙŠÙÙØ¹ÙÙ‘Ù„ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ Ù…Ø¹Ù‡ 3 ÙƒØ±ÙˆØª ÙŠÙÙ‚Ø§Ø¨Ù„ Ø¨Ø§Ù„Ø¯ÙˆØ± Ø¨Ø¹Ø¯ Ù†ÙØ§Ø¯ Ø§Ù„Ø³Ø­Ø¨Ø©
  let timerId=null, timeLeft=10;

  const el=id=>document.getElementById(id);
  const log=m=>{const d=document.createElement('div'); d.textContent=m; el('log').prepend(d);};

  function buildBigDeck(){
    const d=[];
    for(const r of RANKS){ for(let i=0;i<COPIES_PER_RANK;i++){ d.push({r,id:`${r}-${i}-${Math.random().toString(36).slice(2,7)}`}); } }
    for(let j=0;j<JOKERS_COUNT;j++){ d.push({r:'ğŸƒŸ',id:`J-${j}-${Math.random().toString(36).slice(2,7)}`}); }
    for(let i=d.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [d[i],d[j]]=[d[j],d[i]]; }
    return d;
  }
  function pickGroundAllRanks(){
    const g=[], seen=new Set();
    for(const c of deck){
      if(c.r!=='ğŸƒŸ' && !seen.has(c.r)){ g.push(c); seen.add(c.r); }
      if(seen.size===RANKS.length) break;
    }
    deck=deck.filter(c=>!g.includes(c));
    return g;
  }
  function topUpToSix(pIdx){ while(players[pIdx].hand.length<6 && stock.length) players[pIdx].hand.push(stock.pop()); }

  function deal(){
    deck=buildBigDeck();
    players=Array.from({length:PLAYERS},(_,i)=>({idx:i,name:`Ù„Ø§Ø¹Ø¨ ${NAMES[i]}`,team:TEAM(i),hand:[],eat:[]}));
    dealer=Math.floor(Math.random()*PLAYERS);
    ground=pickGroundAllRanks();
    stock=deck; deck=[];
    const starter=Math.floor(Math.random()*PLAYERS);
    for(let r=0;r<5;r++){ for(let p=0;p<PLAYERS;p++){ if(stock.length) players[p].hand.push(stock.pop()); } }
    if(stock.length) players[starter].hand.push(stock.pop());
    turn=starter; shown=false; selected=null; phase='normal'; endgameUnlocked=false;
    el('winner').style.display='none'; el('winnerText').textContent='';
    renderAll(); fillRankSelect();
    enable({deal:false,show:true,buy:false,pass:false,next:false});
    log(`Ø§Ù„Ø¯ÙŠÙ„Ø±: ${players[dealer].name} â€” Ø§Ù„Ø¨Ø§Ø¯Ø¦: ${players[starter].name}`);
    startTimer();
  }

  function enable({deal,show,buy,pass,next}){
    el('btnDeal').disabled=!deal; el('btnShow').disabled=!show; el('btnBuy').disabled=!buy;
    el('btnPass').disabled=!pass; el('btnNext').disabled=!next;
    el('rankSelect').disabled=!(buy||pass);
  }

  function seatPos(i){
    const a=el('arena'), rect=a.getBoundingClientRect();
    const r=Math.min(rect.width,rect.height)/2-90;
    const cx=rect.width/2, cy=rect.height/2;
    const ang=(Math.PI*2)*(i/PLAYERS)-Math.PI/2;
    return {left: cx+r*Math.cos(ang)-75, top: cy+r*Math.sin(ang)-70};
  }

  function cardEl(c,faceUp,onClick){
    const d=document.createElement('div'); d.className='card '+(faceUp?'':'back');
    d.textContent=faceUp?(c.r==='1'?'A':c.r):''; if(onClick) d.addEventListener('click',onClick); return d;
  }

  function renderAll(){
    el('ground').innerHTML=''; ground.forEach(c=>el('ground').appendChild(cardEl(c,true)));
    el('stockLeft').textContent=stock.length; el('phaseLabel').textContent=(phase==='normal'?'Ø¹Ø§Ø¯ÙŠ':'Ø§Ù„Ù†Ù‡Ø§ÙŠØ©');
    const arena=el('arena'); Array.from(arena.querySelectorAll('.seat')).forEach(e=>e.remove());
    for(let i=0;i<PLAYERS;i++){
      const seat=document.createElement('div'); seat.className='seat'; const p=seatPos(i); seat.style.left=p.left+'px'; seat.style.top=p.top+'px';
      const nm=document.createElement('div'); nm.className='name '+players[i].team;
      nm.textContent=players[i].name+(i===turn?' â€¢ Ø¯ÙˆØ±Ù‡':''); if(i===dealer){const d=document.createElement('div'); d.className='dealerTag'; d.textContent='DEALER'; seat.appendChild(d);}
      const hand=document.createElement('div'); hand.className='hand'; const face=(i===turn&&shown);
      players[i].hand.forEach((c,idx)=>{ const elc=cardEl(c,face,()=>selectCard(i,idx)); if(selected&&selected.pIdx===i&&selected.cIdx===idx) elc.classList.add('sel'); hand.appendChild(elc); });
      const eat=document.createElement('div'); eat.className='eat'; players[i].eat.forEach(c=>eat.appendChild(cardEl(c,true)));
      seat.appendChild(nm); seat.appendChild(hand); seat.appendChild(eat); arena.appendChild(seat);
    }
    // live scores (Ø¥Ø±Ø´Ø§Ø¯ÙŠØ© ÙÙ‚Ø·Ø› Ø§Ù„Ø­Ø³Ù… Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ø§Ø­Ù‚Ø§Ù‹)
    let g=0,o=0; for(const p of players){ const pts=p.eat.filter(x=>SCORING.has(x.r)).length; if(p.team==='green') g+=pts; else o+=pts; }
    el('scoreGreen').textContent=g; el('scoreOrange').textContent=o;
    el('turnLabel').textContent=players[turn].name+(players[turn].team==='green'?' (Ø§Ù„Ø£Ø®Ø¶Ø±)':' (Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ)');
  }

  function selectCard(pIdx,cIdx){ if(pIdx!==turn||!shown) return; selected={pIdx,cIdx}; renderAll(); enable({deal:false,show:true,buy:phase==='normal',pass:true,next:true}); fillRankSelect(); }
  function fillRankSelect(){
    const s=el('rankSelect'); s.innerHTML='';
    if(!(shown && players[turn])) return;
    const ranks=[...new Set(players[turn].hand.map(c=>c.r))];
    ranks.forEach(r=>{ const o=document.createElement('option'); o.value=r; o.textContent=(r==='1'?'A':r); s.appendChild(o); });
  }

  function ensureTurnTopUp(){
    if(phase==='normal' && stock.length>0) {
      while(players[turn].hand.length<6 && stock.length) players[turn].hand.push(stock.pop());
      if(stock.length===0){ // Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø³Ø­Ø¨Ø© -> Ø¯Ø®ÙˆÙ„ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
        phase='end';
        endgameUnlocked=false; // ØªØªÙØ¹Ù„ Ø¹Ù†Ø¯ Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ 3 ÙƒØ±ÙˆØª ÙŠÙÙ‚Ø§Ø¨Ù„
        log('Ø§Ù†ØªÙ‡Øª Ø§Ù„Ø³Ø­Ø¨Ø© â€” Ø¯Ø®Ù„Ù†Ø§ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ÙŠØ±Ù…ÙŠ ÙƒØ±Øª)');
      }
    }
    renderAll();
  }

  function showMyHand(){
    shown=!shown; if(!shown) selected=null;
    ensureTurnTopUp();
    enable({deal:false,show:true,buy:(shown&&phase==='normal'),pass:shown,next:shown});
    fillRankSelect();
  }

  function findInGroundOrEats(rank){
    let idx=ground.findIndex(c=>c.r===rank);
    if(idx>-1) return {where:'ground',idx};
    for(let i=0;i<players.length;i++){
      const j=players[i].eat.findIndex(c=>c.r===rank);
      if(j>-1) return {where:'eat',idx:j,pIdx:i};
    }
    return null;
  }

  function buy(){
    if(phase!=='normal'){ alert('Ø§Ù„Ø£ÙƒÙ„ Ù…Ø³Ù…ÙˆØ­ ÙÙŠ Ø§Ù„Ù„Ø¹Ø¨ Ø§Ù„Ø¹Ø§Ø¯ÙŠ ÙÙ‚Ø·'); return; }
    if(!shown){ alert('Ø¥Ø¸Ù‡Ø§Ø± ÙŠØ¯Ùƒ Ø£ÙˆÙ„'); return; }
    const rSel=selected ? players[turn].hand[selected.cIdx].r : el('rankSelect').value;
    if(!rSel){ alert('Ø§Ø®ØªØ± ÙˆØ±Ù‚Ø© Ù…Ù† ÙŠØ¯Ùƒ'); return; }
    let targetRank=rSel;
    if(rSel==='ğŸƒŸ'){ // Ø¬ÙˆÙƒØ± ÙŠØ£ÙƒÙ„ Ø£ÙˆÙ„ Ø±Ù‚Ù… Ù…ØªØ§Ø­
      let found=null; for(const rk of RANKS){ const f=findInGroundOrEats(rk); if(f){found={rk,f}; break;} }
      if(!found){ alert('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø£ÙŠ Ù‡Ø¯Ù Ù„Ù„Ø£ÙƒÙ„ Ø­Ø§Ù„ÙŠØ§Ù‹'); return; }
      targetRank=found.rk;
    }
    const spot=findInGroundOrEats(targetRank);
    if(!spot){ alert('Ù…Ø§ ÙÙŠÙ‡ Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ù„Ø§ ÙÙŠ Ø§Ù„Ø£Ø±Ø¶ ÙˆÙ„Ø§ ÙÙŠ Ø£ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†'); return; }
    const hIdx=players[turn].hand.findIndex(c=>c.r===rSel);
    if(hIdx===-1){ alert('Ù‡Ø°Ù‡ Ø§Ù„ÙˆØ±Ù‚Ø© Ù„ÙŠØ³Øª ÙÙŠ ÙŠØ¯Ùƒ'); return; }
    const my=players[turn].hand.splice(hIdx,1)[0];
    const taken = (spot.where==='ground') ? ground.splice(spot.idx,1)[0] : players[spot.pIdx].eat.splice(spot.idx,1)[0];
    players[turn].eat.push(my,taken);
    log(`${players[turn].name} Ø£ÙƒÙ„ ${targetRank}${rSel==='ğŸƒŸ'?' (Ø¬ÙˆÙƒØ±)':''}`);
    selected=null; shown=false; nextTurn();
  }

  function passWithDiscard(){
    if(!shown){ alert('Ø¥Ø¸Ù‡Ø§Ø± ÙŠØ¯Ùƒ Ø£ÙˆÙ„'); return; }
    const rSel=selected ? players[turn].hand[selected.cIdx].r : el('rankSelect').value;
    if(!rSel){ alert('Ø§Ø®ØªØ± ÙƒØ±Øª'); return; }
    if(phase==='normal'){
      // Ù‚Ø¨Ù„ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: ÙŠÙ…Ù†Ø¹ Ø§Ù„Ù‚Ø·Ù‘ Ø¥Ø°Ø§ Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„Ø£Ø±Ø¶/Ø§Ù„Ø£ÙƒÙ„
      if(rSel!=='ğŸƒŸ' && (ground.some(c=>c.r===rSel) || players.some(p=>p.eat.some(c=>c.r===rSel)))){
        alert('Ù„Ø§ ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„Ù‚Ø·Ù‘ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù†ÙØ³ Ø§Ù„Ø±Ù‚Ù… Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„Ø£Ø±Ø¶ Ø£Ùˆ ÙÙŠ Ø£ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†');
        return;
      }
    }
    // ÙÙŠ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: Ø£ÙŠ ÙƒØ±Øª Ù…Ø³Ù…ÙˆØ­
    const i=players[turn].hand.findIndex(c=>c.r===rSel);
    const card=players[turn].hand.splice(i,1)[0];
    ground.push(card);
    log(`${players[turn].name} Ù‚Ø·Ù‘ ${rSel}${phase==='end'?' (Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©)':''}`);
    selected=null; shown=false; nextTurn();
  }

  function allHandsEmpty(){ return players.every(p=>p.hand.length===0); }

  function nextTurn(){
    // Ø§Ù†ØªÙ‚Ø§Ù„ Ø§Ù„Ø¯ÙˆØ±
    turn=(turn+1)%PLAYERS;

    // Ù‚ÙˆØ§Ø¹Ø¯ Ù…Ø±Ø­Ù„Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©:
    if(phase==='end'){
      // ØªÙØ¹ÙŠÙ„ Ù‚Ø§Ø¹Ø¯Ø© "Ø£ÙˆÙ„ Ù„Ø§Ø¹Ø¨ 3 ÙƒØ±ÙˆØª ÙŠØ¨Ø¯Ø£"
      if(!endgameUnlocked){
        if(players[turn].hand.length===3){ endgameUnlocked=true; }
        else { // ØªØ®Ø·ÙŠ Ø­ØªÙ‰ Ù†ØµÙ„ Ù„Ø£ÙˆÙ„ 3
          renderAll(); startTimer(); return nextTurn();
        }
      }else{
        // Ø¨Ø¹Ø¯ Ø§Ù„ØªÙØ¹ÙŠÙ„: ÙŠÙ„Ø¹Ø¨ Ø§Ù„Ø¬Ù…ÙŠØ¹ Ø·Ø¨ÙŠØ¹ÙŠ (Ø­ØªÙ‰ Ø£ØµØ­Ø§Ø¨ 3)
      }
      // Ø¥Ø°Ø§ Ø§Ù„ÙƒÙ„ Ø®Ù„Øµ â†’ Ù†Ø­Ø³Ø¨
      if(allHandsEmpty()){ finalScore(); enable({deal:true,show:false,buy:false,pass:false,next:false}); stopTimer(); return; }
    }

    ensureTurnTopUp();
    enable({deal:false,show:true,buy:false,pass:false,next:false});
    startTimer();
  }

  /* ======= Ø§Ù„Ù…Ø¤Ù‚Øª (10 Ø«ÙˆØ§Ù†ÙŠ) ======= */
  function stopTimer(){ if(timerId){ clearInterval(timerId); timerId=null; } el('timer').textContent='â€”'; }
  function startTimer(){
    stopTimer();
    timeLeft=10; el('timer').textContent=timeLeft;
    timerId=setInterval(()=>{
      timeLeft--; el('timer').textContent=timeLeft;
      if(timeLeft<=0){ stopTimer(); autoPlay(); }
    },1000);
  }
  function autoPlay(){
    // Ù„Ùˆ Ù…Ø§ Ù„Ø¹Ø¨ Ø®Ù„Ø§Ù„ 10 Ø«ÙˆØ§Ù†ÙŠ:
    if(phase==='normal'){
      // Ù†Ø­Ø§ÙˆÙ„ Ø£ÙƒÙ„ ØªÙ„Ù‚Ø§Ø¦ÙŠ (Ù„Ùˆ Ù…Ù…ÙƒÙ†)ØŒ ÙˆØ¥Ù„Ø§ Ù‚Ø·Ù‘ Ù‚Ø§Ù†ÙˆÙ†ÙŠØŒ ÙˆØ¥Ù„Ø§ ØªÙ…Ø±ÙŠØ±
      const me=players[turn];
      // Ù…Ø­Ø§ÙˆÙ„Ø© Ø£ÙƒÙ„
      let did=false;
      for(let i=0;i<me.hand.length;i++){
        const r=me.hand[i].r==='ğŸƒŸ' ? (RANKS.find(rk=>findInGroundOrEats(rk))||null) : me.hand[i].r;
        if(!r) continue;
        const spot = findInGroundOrEats(r);
        if(spot){
          const my=me.hand.splice(i,1)[0];
          const taken=(spot.where==='ground')?ground.splice(spot.idx,1)[0]:players[spot.pIdx].eat.splice(spot.idx,1)[0];
          me.eat.push(my,taken);
          log(`${me.name} (Ø£ÙˆØªÙˆ) Ø£ÙƒÙ„ ${r}`);
          did=true; break;
        }
      }
      if(!did){
        // Ù‚Ø·Ù‘ Ù‚Ø§Ù†ÙˆÙ†ÙŠ
        const idx=me.hand.findIndex(c=> c.r==='ğŸƒŸ' || (!ground.some(g=>g.r===c.r) && !players.some(p=>p.eat.some(e=>e.r===c.r))));
        if(idx>-1){
          const card=me.hand.splice(idx,1)[0]; ground.push(card);
          log(`${me.name} (Ø£ÙˆØªÙˆ) Ù‚Ø·Ù‘ ${card.r}`);
          did=true;
        }
      }
      selected=null; shown=false; turn=(turn-1+PLAYERS)%PLAYERS; // Ø³Ù†Ø¹ÙŠØ¯Ù‡ Ù„Ø£Ù† nextTurn ÙŠØ²ÙŠØ¯
      nextTurn();
    }else{
      // Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: Ù‚Ø·Ù‘ Ø£ÙŠ ÙƒØ±Øª
      const me=players[turn];
      if(me.hand.length){
        const card=me.hand.pop(); ground.push(card);
        log(`${me.name} (Ø£ÙˆØªÙˆ) Ù‚Ø·Ù‘ ${card.r} â€” Ù†Ù‡Ø§ÙŠØ©`);
      }
      selected=null; shown=false; turn=(turn-1+PLAYERS)%PLAYERS;
      nextTurn();
    }
  }
  /* ================================= */

  function finalScore(){
    let g=0,o=0; for(const p of players){ const pts=p.eat.filter(c=>SCORING.has(c.r)).length; if(p.team==='green') g+=pts; else o+=pts; }
    const text=`Ø§Ù„Ø£Ø®Ø¶Ø±: ${g} â€” Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ: ${o} â€” `+(g===o?'ØªØ¹Ø§Ø¯Ù„':(g>o?'ÙØ§Ø² ÙØ±ÙŠÙ‚ Ø§Ù„Ø£Ø®Ø¶Ø±':'ÙØ§Ø² ÙØ±ÙŠÙ‚ Ø§Ù„Ø¨Ø±ØªÙ‚Ø§Ù„ÙŠ'));
    el('winnerText').textContent=text; el('winner').style.display='flex'; alert(text);
  }

  // Ø±Ø¨Ø· Ø§Ù„Ø£Ø²Ø±Ø§Ø±
  el('btnDeal').addEventListener('click', deal);
  el('btnShow').addEventListener('click', showMyHand);
  el('btnBuy').addEventListener('click', buy);
  el('btnPass').addEventListener('click', passWithDiscard);
  el('btnNext').addEventListener('click', ()=>{ selected=null; shown=false; nextTurn(); });
  el('btnScore').addEventListener('click', ()=>{ if(phase!=='end' || !allHandsEmpty()) alert('Ø§Ù„Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ø¨Ø¹Ø¯ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨Ø© Ø«Ù… ØªÙØ±ÙŠØº ÙƒÙ„ Ø§Ù„Ø£ÙŠØ§Ø¯ÙŠ.'); else finalScore(); });

  // Ø¨Ø¯Ø§ÙŠØ©
  enable({deal:false,show:false,buy:false,pass:false,next:false});
})();
</script>
</body>
</html>
