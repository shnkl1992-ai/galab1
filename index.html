<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Ù‚Ù„Ø§Ø¨ 1 â€” Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„Ø¯Ø§Ø¦Ø±Ø© + Ø£Ø±Ø¶ 1..K + Ø³Ø­Ø¨ Ù„Ù€ 6 Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„</title>
<style>
  :root{--bg:#0b1020;--fg:#e6ecff;--green:#22c55e;--orange:#f59e0b}
  *{box-sizing:border-box}
  body{margin:0;background:#0b1020;color:var(--fg);font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  header{display:flex;gap:8px;flex-wrap:wrap;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #223}
  h1{font-size:16px;margin:0}
  button{padding:8px 12px;border:1px solid #335;background:#182044;color:var(--fg);border-radius:10px}
  select{padding:8px 10px;border:1px solid #335;background:#0f1a37;color:var(--fg);border-radius:10px}
  .wrap{max-width:1200px;margin:12px auto;padding:0 12px}
  .grid{display:grid;grid-template-columns:1fr 320px;gap:12px}
  .arena{position:relative;height:620px;border:1px solid #223;border-radius:16px;background:radial-gradient(circle at 50% 40%,#111a3a 0%,#0b1020 70%)}
  .table{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);width:420px;height:420px;border-radius:999px;background:#0e1e3a;border:2px solid #2a355e;display:flex;align-items:center;justify-content:center;flex-wrap:wrap;padding:10px;gap:6px}
  .seat{position:absolute;width:160px;text-align:center}
  .name{font-size:13px;margin-bottom:6px}
  .name.green{color:var(--green)} .name.orange{color:var(--orange)}
  .hand,.eat{display:flex;gap:6px;justify-content:center;flex-wrap:wrap;min-height:58px}
  .eat{min-height:40px;margin-top:6px}
  .card{width:42px;height:60px;border-radius:8px;background:linear-gradient(180deg,#1f2547,#11162c);border:1px solid #3a4577;display:flex;align-items:center;justify-content:center;font-weight:700}
  .back{background:linear-gradient(135deg,#103060,#3b82f6)}
  .sel{outline:2px solid #60a5fa;outline-offset:2px}
  .side{border:1px solid #223;border-radius:16px;padding:10px}
  .log{height:260px;overflow:auto;border-top:1px dashed #2a355e;margin-top:8px;padding-top:6px;font-size:13px;line-height:1.5}
  .pill{display:inline-block;background:#1a274a;border-radius:999px;padding:4px 8px;font-size:12px;margin-inline-start:6px}
</style>
</head>
<body>
<header>
  <h1>Ù‚Ù„Ø§Ø¨ 1 â€” Ø§Ø®ØªØ¨Ø§Ø± Ù…ÙˆØ³Ù‘Ø¹</h1>
  <div style="display:flex;gap:8px;flex-wrap:wrap">
    <button id="deal">ØªÙˆØ²ÙŠØ¹</button>
    <button id="show" disabled>Ø¥Ø¸Ù‡Ø§Ø± ÙŠØ¯ÙŠ</button>
    <select id="rankSel" disabled></select>
    <button id="buy" disabled>Ø£ÙƒÙ„</button>
    <button id="discard" disabled>Ù‚Ø·/ØªÙ…Ø±ÙŠØ±</button>
    <button id="next" disabled>Ø§Ù„ØªØ§Ù„ÙŠ</button>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <div class="arena" id="arena">
      <div class="table" id="groundBox"></div>
    </div>
    <div class="side">
      <div>Ø§Ù„Ø¯ÙˆØ±: <b id="turnLabel">â€”</b>
        <span class="pill">Ø§Ù„Ø£Ø±Ø¶: <b id="groundList"></b></span>
        <span class="pill">Ø§Ù„Ø³Ø­Ø¨Ø©: <b id="stockLeft">â€”</b></span>
      </div>
      <div class="log" id="log"></div>
    </div>
  </div>
</div>

<script>
(() => {
  const PLAYERS = 6;
  const TEAM = i => i % 2 === 0 ? "green" : "orange";
  const NAMES = ["A","B","C","D","E","F"];
  const RANKS = ["1","2","3","4","5","6","7","8","9","10","J","Q","K"];
  const SCORING = new Set(["10","J","Q","K","1"]); // Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù„Ù„Ø­Ø³Ø§Ø¨

  // Ø¹Ù†Ø§ØµØ±
  const arena = id("arena"), groundBox = id("groundBox");
  const logEl = id("log"), rankSel = id("rankSel");

  // Ø­Ø§Ù„Ø©
  let deck = [], stock = [], players = [], ground = [], turn = 0, shown = false, selIdx = null;

  // Ø£Ø¯ÙˆØ§Øª
  function id(x){ return document.getElementById(x); }
  function log(msg){ const d=document.createElement("div"); d.textContent=msg; logEl.prepend(d); }
  function seatPos(i){
    const rect = arena.getBoundingClientRect();
    // ÙˆØ³Ù‘Ø¹Ù†Ø§ Ù†ØµÙ Ø§Ù„Ù‚Ø·Ø± Ø¹Ø´Ø§Ù† ØªØ¨Ø¹Ø¯ Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯
    const r = Math.min(rect.width, rect.height)/2 - 35;
    const cx = rect.width/2, cy = rect.height/2;
    const ang = (Math.PI*2)*(i/PLAYERS) - Math.PI/2;
    return { left: cx + r*Math.cos(ang) - 80, top: cy + r*Math.sin(ang) - 72 };
  }
  function cardEl(txt, faceUp, onClick){
    const d = document.createElement("div");
    d.className = "card " + (faceUp ? "" : "back");
    d.textContent = faceUp ? txt : "";
    if(onClick) d.onclick = onClick;
    return d;
  }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } return a; }

  function buildBigDeck(){
    // Ù†Ø³Ø®Ø© Ø®ÙÙŠÙØ© (4 Ù†Ø³Ø® Ù„ÙƒÙ„ Ø±Ù‚Ù…) Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø³Ø±ÙŠØ¹Ø© â€” Ù„Ø§Ø­Ù‚Ù‹Ø§ Ù†Ø±ÙØ¹Ù‡Ø§ Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„ÙƒØ¨ÙŠØ±Ø©
    const d=[];
    for(const r of RANKS){ for(let i=0;i<4;i++) d.push(r); }
    d.push(...Array(6).fill("ğŸƒŸ")); // Ø´ÙˆÙŠØ© Ø¬ÙˆØ§ÙƒØ± Ù„Ù„ØªØ¬Ø±Ø¨Ø©
    return shuffle(d);
  }

  function renderGround(){
    groundBox.innerHTML = "";
    ground.forEach(r => groundBox.appendChild(cardEl(r, true)));
    id("groundList").textContent = ground.join(" ");
  }

  function renderSeats(){
    // Ø§Ù…Ø³Ø­ Ø§Ù„Ù…Ù‚Ø§Ø¹Ø¯ ÙˆØ§Ø±Ø³Ù… Ù…Ù† Ø¬Ø¯ÙŠØ¯
    [...arena.querySelectorAll(".seat")].forEach(n=>n.remove());
    for(let i=0;i<PLAYERS;i++){
      const seat = document.createElement("div");
      seat.className = "seat";
      const p = seatPos(i);
      seat.style.left = p.left+"px"; seat.style.top = p.top+"px";

      const nm = document.createElement("div");
      nm.className = "name "+TEAM(i);
      nm.textContent = `Ù„Ø§Ø¹Ø¨ ${NAMES[i]}${i===turn?" â€¢ Ø¯ÙˆØ±Ù‡":""}`;

      const hand = document.createElement("div"); hand.className="hand";
      const eat  = document.createElement("div"); eat.className="eat";
      const face = (i===turn && shown);
      players[i].hand.forEach((r,idx)=>{
        const elc = cardEl(r, face, ()=>{
          if(i!==turn || !shown) return;
          selIdx = idx; renderSeats();
          fillRankSel();
        });
        if(i===turn && selIdx===idx) elc.classList.add("sel");
        hand.appendChild(elc);
      });
      players[i].eat.forEach(r=> eat.appendChild(cardEl(r,true)));

      seat.appendChild(nm);
      seat.appendChild(hand);
      seat.appendChild(eat);
      arena.appendChild(seat);
    }
  }

  function renderAll(){
    renderGround();
    renderSeats();
    id("turnLabel").textContent = `Ù„Ø§Ø¹Ø¨ ${NAMES[turn]}`;
    id("stockLeft").textContent = stock.length;
    id("show").disabled = false;
    id("buy").disabled  = !(shown && players[turn].hand.length);
    id("discard").disabled = !(shown && players[turn].hand.length);
    id("next").disabled = !shown;
  }

  function fillRankSel(){
    rankSel.innerHTML = "";
    if(!(shown && players[turn])){ rankSel.disabled = true; return; }
    const ranks = [...new Set(players[turn].hand)];
    ranks.forEach(r=>{ const o=document.createElement("option"); o.value=r; o.textContent=r; rankSel.appendChild(o); });
    rankSel.disabled = ranks.length===0;
  }

  function topUpToSix(pIdx){
    while(players[pIdx].hand.length < 6 && stock.length){
      players[pIdx].hand.push(stock.pop());
    }
  }

  // Ø£Ø²Ø±Ø§Ø±
  id("deal").onclick = () => {
    deck = buildBigDeck();
    // Ø§Ù„Ø£Ø±Ø¶ = 13 (1..K)
    ground = [...RANKS]; // ØªÙØ¹Ø±Ø¶ ÙƒÙ„Ù‡Ø§ Ù…Ù† Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    // Ø£Ø¨Ø¹Ø¯ Ù‡Ø°Ù‡ Ø§Ù„Ø£ÙˆØ±Ø§Ù‚ Ù…Ù† Ø§Ù„Ø¯Ùƒ (Ù„Ùˆ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©)
    for(const r of RANKS){
      const i = deck.indexOf(r);
      if(i>-1) deck.splice(i,1);
    }
    // Ø§Ù„Ø¨Ø§Ù‚ÙŠ ÙŠØµÙŠØ± Ø³ØªÙˆÙƒ
    stock = deck;

    // Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
    players = Array.from({length:PLAYERS}, ()=>({hand:[], eat:[]}));
    // ØªÙˆØ²ÙŠØ¹ 5 Ù„ÙƒÙ„ Ù„Ø§Ø¹Ø¨ + Ù„Ø§Ø¹Ø¨ Ø¹Ø´ÙˆØ§Ø¦ÙŠ ÙŠØ§Ø®Ø° Ø§Ù„Ø³Ø§Ø¯Ø³Ø©
    for(let r=0;r<5;r++){ for(let p=0;p<PLAYERS;p++){ if(stock.length) players[p].hand.push(stock.pop()); } }
    const starter = Math.floor(Math.random()*PLAYERS);
    if(stock.length) players[starter].hand.push(stock.pop());
    turn = starter; shown = false; selIdx = null;

    log(`ØªÙ… Ø§Ù„ØªÙˆØ²ÙŠØ¹ â€” Ø§Ù„Ø¨Ø§Ø¯Ø¦: Ù„Ø§Ø¹Ø¨ ${NAMES[starter]}. Ø§Ù„Ø£Ø±Ø¶: 1..K Ø¸Ø§Ù‡Ø±Ø©.`);
    renderAll(); fillRankSel();
  };

  id("show").onclick = () => {
    shown = !shown; if(!shown) selIdx=null;
    renderAll(); fillRankSel();
  };

  // Ø§Ù„Ø£ÙƒÙ„: ÙŠØ¨Ø­Ø« Ø£ÙˆÙ„Ù‹Ø§ ÙÙŠ Ø§Ù„Ø£Ø±Ø¶ØŒ Ø«Ù… ÙÙŠ Ø£ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
  id("buy").onclick = () => {
    if(!shown) return alert("Ø§Ø¸Ù‡Ø± ÙŠØ¯Ùƒ Ø£ÙˆÙ„");
    const me = players[turn];
    const pick = selIdx ?? 0;
    const rSel = me.hand[pick];
    if(!rSel) return;

    let takenFrom = null;
    // 1) Ø§Ù„Ø£Ø±Ø¶
    let gIdx = ground.findIndex(x=>x===rSel);
    if(gIdx>-1){ ground.splice(gIdx,1); takenFrom = "Ø§Ù„Ø£Ø±Ø¶"; }
    else{
      // 2) Ø£ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†
      for(let i=0;i<players.length;i++){
        const j = players[i].eat.findIndex(x=>x===rSel);
        if(j>-1){ players[i].eat.splice(j,1); takenFrom = `Ø£ÙƒÙ„ Ù„Ø§Ø¹Ø¨ ${NAMES[i]}`; break; }
      }
    }
    if(!takenFrom){ return alert(`Ù…Ø§ ÙÙŠÙ‡ ${rSel} Ù„Ø§ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶ ÙˆÙ„Ø§ ÙÙŠ Ø£ÙƒÙ„ Ø§Ù„Ù„Ø§Ø¹Ø¨ÙŠÙ†`); }

    // Ø£Ø¶Ù ÙˆØ±Ù‚ØªÙŠ + Ø§Ù„Ù…ÙÙ„ØªÙ‚Ø·Ø© Ø¥Ù„Ù‰ Ø£ÙƒÙ„ÙŠ
    const my = me.hand.splice(pick,1)[0];
    me.eat.push(my, rSel);
    log(`Ù„Ø§Ø¹Ø¨ ${NAMES[turn]} Ø£ÙƒÙ„ ${rSel} Ù…Ù† ${takenFrom}.`);
    // Ø¨Ø¹Ø¯ Ø§Ù„Ø£ÙƒÙ„: Ø§Ù„Ø¯ÙŠÙ„Ø± ÙŠÙƒÙ…Ù‘Ù„ ÙŠØ¯ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¥Ù„Ù‰ 6
    topUpToSix(turn);
    shown = false; selIdx = null;
    renderAll(); fillRankSel();
  };

  // Ø§Ù„Ù‚Ø·/Ø§Ù„ØªÙ…Ø±ÙŠØ±: ÙŠØ±Ù…ÙŠ Ø§Ù„ÙƒØ±Øª Ø§Ù„Ù…Ø®ØªØ§Ø± Ù„Ù„Ø£Ø±Ø¶
  id("discard").onclick = () => {
    if(!shown) return alert("Ø§Ø¸Ù‡Ø± ÙŠØ¯Ùƒ Ø£ÙˆÙ„");
    const me = players[turn];
    const pick = selIdx ?? 0;
    const rSel = me.hand.splice(pick,1)[0];
    if(!rSel) return;
    // Ø´Ø±Ø· â€œÙ…Ø§ ÙŠÙƒÙˆÙ† Ù…ÙˆØ¬ÙˆØ¯ Ø¨Ø§Ù„Ø£Ø±Ø¶ ÙˆÙ„Ø§ Ø§Ù„Ø£ÙƒÙ„â€ Ù†Ø¶ÙŠÙÙ‡ Ù„Ø§Ø­Ù‚Ù‹Ø§ â€” Ø§Ù„Ø¢Ù† Ù†Ø®Ù„ÙŠÙ‡Ø§ Ù…ÙØªÙˆØ­Ø© Ù„Ù„ØªØ¬Ø±Ø¨Ø©
    ground.push(rSel);
    log(`Ù„Ø§Ø¹Ø¨ ${NAMES[turn]} Ù‚Ø· ${rSel} Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ø¶.`);
    shown = false; selIdx = null;
    renderAll(); fillRankSel();
  };

  id("next").onclick = () => {
    shown = false; selIdx = null;
    turn = (turn+1)%PLAYERS;
    // Ø¨Ø¯Ø§ÙŠØ© Ø§Ù„Ø¯ÙˆØ± Ø§Ù„Ø¬Ø¯ÙŠØ¯: ÙƒÙ…Ù‘Ù„ ÙŠØ¯Ù‡ Ù„Ø³ØªØ© (Ù„Ùˆ ØªØ¨ÙŠ Ù†ÙØ³ Ù…Ù†Ø·Ù‚ÙƒÙ… Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø³Ø­Ø¨Ø©)
    topUpToSix(turn);
    log(`Ø§Ù„Ø¯ÙˆØ± â†’ Ù„Ø§Ø¹Ø¨ ${NAMES[turn]}`);
    renderAll(); fillRankSel();
  };

  // Ø¨Ø¯Ø§ÙŠØ© ÙØ§Ø±ØºØ©
  players = Array.from({length:PLAYERS}, ()=>({hand:[], eat:[]})); ground=[]; stock=[];
  renderAll();

})();
</script>
</body>
</html>
